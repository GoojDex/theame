function sneeit_theme_updates(){$(document).find(".sneeit-theme-app-toolbar-updates").html(html_tag("h2","","Updates")),$(document).find(".sneeit-theme-app-page-updates").html(html_tag("p",".sneeit-msg.sneeit-msg-warning",html_tag_icon("warning","sneeit-msg-icon")+"We recommend you should better BACKUP your code before doing this task")+html_tag("p","","Input the latest xml code into the following field, then click UPDATE")+html_tag("textarea",".sneeit-theme-update-code-input")+html_tag("button",".sneeit-theme-update-merge-button","Update"))}function sneeit_theme_update_actions(){$(document).on("click",".sneeit-theme-update-merge-button",function(){var e=$(document).find(".sneeit-theme-update-code-input").val();if(empty(e))return alert("Please input new theme code");confirm("Did you backup your code?")&&(e=sneeit_theme_update_apply(e),e!=theme.code.current&&(e=theme_fix_blogger_unicode_error(e),theme.code.set(e),setTimeout(function(){theme.wrapper.toolbar.buttons.primary_button.click()},200)))})}function sneeit_theme_update_apply(e){var t=sneeit_theme_options_scan(e,SETTINGS),n=theme.code.current.indexOf(sneeit_theme_option_anchor);if(-1==n&&(n=theme.code.current.indexOf(sneeit_theme_option_anchor_new)),!sneeit_is_error(t)&&-1!=n){let i=theme.code.current,r=sneeit_theme_options_scan(i,SETTINGS);i=i.substring(0,n),console.log("UPDATE APPLY",t,r);for(let e in t){let n=sneeit_get_str_between_keys(i,t[e].start,t[e].end);"sneeit-license-key"==e&&console.log(n),null==n&&e in r&&(n=r[e].value),"sneeit-license-key"==e&&console.log(n),null!=n?("sneeit-license-key"==e&&console.log(n),t[e].value=n):console.log("Null",e)}e=sneeit_theme_option_apply(e,t,SETTINGS)}var i=sneeit_theme_translate_scan(e);if(!empty(i)){var r=sneeit_theme_translate_scan(theme.code.current);for(var o in i)o in r&&null!==r[o]&&(i[o]=r[o]);e=sneeit_theme_translate_apply(i,e)}var s=sneeit_theme_menu_scan(e),m=sneeit_theme_menu_scan(theme.code.current);if(!sneeit_is_error(s)&&!sneeit_is_error(m)){for(var l in s)l in m&&!m[l].error&&!s[l].error&&(s[l]=m[l]);e=sneeit_theme_menu_apply(s,e)}var a=new XMLStringElement(theme.code.current),_=new XMLStringElement(e),c=new XMLStringElement(e),u=a.getElements("b:section"),d=c.getElements("b:section"),p=_.getElements("b:section");for(var g in d)g in u&&d[g].setHtml(u[g].xml.inner);var h=c.getElements("b:widget?locked=true"),f=_.getElements("b:widget?locked=true");for(var v in h){var b=h[v];v in f||b.selfRemove()}var y=c.getElements("b:widget");for(var g in p)if(g in d){var E=p[g].getElements("b:widget?locked=true");if(!empty(E))for(var v in E)v in y||d[g].appendHtml(E[v].xml.outer)}y=c.getElements("b:widget");for(var g in p)if(g in d){E=p[g].getElements("b:widget?locked=true");if(!empty(E))for(var v in E)if(v in y&&!empty(E[v].xml.inner)){var w=y[v].getElements("b:widget-settings",ARRAY);if(y[v].setHtml(E[v].xml.inner),!empty(w)){var x=y[v].getElements("b:widget-settings",ARRAY);empty(x)?y[v].prependHtml(w[0].xml.outer):x[0].setHtml(w[0].xml.inner)}}}e=c.xml.inner;var k=a.getElements("Variable"),A=c.getElements("Variable");for(var S in e=c.xml.inner,k)e=c.xml.inner,S in A&&"value"in k[S].attr&&(A[S].setAttr("value",k[S].attr.value),e=c.xml.inner);return e=c.xml.inner,e}$(document).on("click",".sneeit-theme-app-menu-item-updates",function(){sneeit_theme_updates()}),sneeit_theme_update_actions();